# E4 実機テスト実施ガイド（最終版）

## 🎯 目的
本番環境でのLINE導線の可用性100%を担保し、iOS/Android実機での動作を証跡付きで確認する。

---

## 📦 準備するもの

### 必須デバイス
- ✅ iOS端末（iPhone、iOS 15.0以上）
- ✅ Android端末（Pixel/Galaxy等、Android 10以上）
- ✅ 両端末にLINEアプリインストール済み

### 環境
- ✅ 安定したWi-Fi接続
- ✅ テストURL: `https://azvelia.vercel.app`（本番）または`https://azvelia-staging.vercel.app`（ステージング）

### ツール
- ✅ スクリーンショット撮影機能
- ✅ ブラウザ開発者ツール（Safari/Chrome）

---

## 🚀 クイックスタート（5ステップ）

### Step 1: 設定確認（2分）
```bash
# 1. main.js の LINE URL確認
# 本番URL: https://line.me/R/ti/p/@azvelia

# 2. UTMパラメータ確認
# utm_campaign: 2025_q4_karaage_order

# 3. test-evidenceディレクトリ確認
ls test-evidence/ios/screenshots/
ls test-evidence/android/screenshots/
```

### Step 2: iOS実機テスト（15分）
```
1. Safariでテストページを開く
2. E4_実機テスト_最終チェックリスト.md に沿ってテスト
3. スクリーンショット5枚撮影
4. トラッキングログをコンソールで確認
5. test-evidence/ios/ に保存
```

### Step 3: Android実機テスト（15分）
```
1. Chromeでテストページを開く
2. E4_実機テスト_最終チェックリスト.md に沿ってテスト
3. スクリーンショット5枚撮影
4. トラッキングログをコンソールで確認
5. test-evidence/android/ に保存
```

### Step 4: ログエクスポート（5分）
```
1. test-evidence/export-logs.html を各端末で開く
2. 「JSON形式でダウンロード」をクリック
3. ダウンロードしたファイルを test-evidence/{ios|android}/logs/ に保存
```

### Step 5: レポート作成（10分）
```
1. test-evidence/test-report-template.md をコピー
2. test-evidence/test-report.md にリネーム
3. テスト結果を記入
4. E1にレビュー依頼
```

---

## 📱 詳細テスト手順

### iOS実機テスト

#### 準備
```
デバイス: iPhone ___________
OS: iOS ___________
ブラウザ: Safari ___________
LINEアプリ: バージョン ___________
```

#### テストシナリオ（11項目）

1. **初期表示確認**
   - Safariでページを開く
   - ヒーローセクションが表示される
   - CTAボタンが2つ表示される
   - 📸 `01_hero_cta.png`

2. **ヒーローCTA → LINE遷移**
   - 「LINEで注文する」をタップ
   - LINEアプリが自動起動
   - 公式アカウント画面に遷移
   - 📸 `04_line_success.png`

3. **QRコード表示**
   - 「QRコードを表示」をタップ
   - モーダルが表示される
   - QRコードが生成される
   - 📸 `02_qr_modal.png`

4. **QRコード読み取り**
   - 別のスマホでQRコードをスキャン
   - LINEアプリが起動
   - 公式アカウント画面に遷移

5. **QRモーダル内CTA**
   - モーダル内の「LINEで開く」をタップ
   - LINEアプリが起動
   - 公式アカウント画面に遷移

6. **モーダルを閉じる（×ボタン）**
   - ×ボタンをタップ
   - モーダルが閉じる
   - スクロールが有効化される

7. **モーダルを閉じる（背景タップ）**
   - モーダルを再度表示
   - 背景をタップ
   - モーダルが閉じる

8. **追従CTA表示**
   - 500px以上スクロール
   - 画面下部に追従CTAが表示
   - 📸 `03_sticky_cta.png`

9. **追従CTA → LINE遷移**
   - 追従CTAをタップ
   - LINEアプリが起動
   - 公式アカウント画面に遷移

10. **トラッキングログ確認**
    - Safari開発者ツールを開く
    - コンソールで `showTrackingLogs()` を実行
    - ログが表示される
    - 📸 `05_tracking_logs.png`

11. **計測パラメータ検証**
    - コンソールで `testLineUrl('hero')` を実行
    - UTMパラメータが正しいか確認

### Android実機テスト

#### 準備
```
デバイス: ___________
OS: Android ___________
ブラウザ: Chrome ___________
LINEアプリ: バージョン ___________
```

#### テストシナリオ（11項目）
※iOS実機テストと同じ手順をChromeで実施

---

## 📊 期待される計測パラメータ

### URL形式
```
https://line.me/R/ti/p/@azvelia
  ?utm_source=azvelia_lp
  &utm_medium=web
  &utm_campaign=2025_q4_karaage_order
  &utm_content=[hero|qr-modal|sticky]
  &timestamp=[UNIX_TIMESTAMP]
  &ref=[hero|qr-modal|sticky]
```

### トラッキングイベント
```json
[
  {
    "timestamp": "2025-10-14T12:34:56.789Z",
    "event": "page_view",
    "params": {
      "page_title": "AZVELIA LP",
      "page_location": "https://azvelia.vercel.app",
      "user_agent": "Mozilla/5.0..."
    }
  },
  {
    "timestamp": "2025-10-14T12:35:12.345Z",
    "event": "line_cta_click",
    "params": {
      "location": "hero",
      "url": "https://line.me/R/ti/p/@azvelia?utm_source=...",
      "device_type": "mobile"
    }
  },
  {
    "timestamp": "2025-10-14T12:35:30.123Z",
    "event": "qr_modal_open",
    "params": {
      "qr_url": "https://line.me/R/ti/p/@azvelia?..."
    }
  },
  {
    "timestamp": "2025-10-14T12:35:45.678Z",
    "event": "line_cta_click",
    "params": {
      "location": "qr-modal",
      "url": "https://line.me/R/ti/p/@azvelia?...",
      "device_type": "mobile"
    }
  },
  {
    "timestamp": "2025-10-14T12:35:50.234Z",
    "event": "qr_modal_close"
  },
  {
    "timestamp": "2025-10-14T12:36:10.456Z",
    "event": "sticky_cta_show",
    "params": {
      "scroll_position": 567
    }
  },
  {
    "timestamp": "2025-10-14T12:36:20.789Z",
    "event": "line_cta_click",
    "params": {
      "location": "sticky",
      "url": "https://line.me/R/ti/p/@azvelia?...",
      "device_type": "mobile"
    }
  }
]
```

---

## 📸 証跡ファイル構成

```
test-evidence/
├── ios/
│   ├── screenshots/
│   │   ├── 01_hero_cta.png          ✅ ヒーローCTA表示
│   │   ├── 02_qr_modal.png          ✅ QRモーダル表示
│   │   ├── 03_sticky_cta.png        ✅ 追従CTA表示
│   │   ├── 04_line_success.png      ✅ LINE遷移成功
│   │   └── 05_tracking_logs.png     ✅ トラッキングログ
│   └── logs/
│       └── tracking_logs.json       ✅ ログJSON
├── android/
│   ├── screenshots/
│   │   ├── 01_hero_cta.png          ✅ ヒーローCTA表示
│   │   ├── 02_qr_modal.png          ✅ QRモーダル表示
│   │   ├── 03_sticky_cta.png        ✅ 追従CTA表示
│   │   ├── 04_line_success.png      ✅ LINE遷移成功
│   │   └── 05_tracking_logs.png     ✅ トラッキングログ
│   └── logs/
│       └── tracking_logs.json       ✅ ログJSON
├── test-report.md                   ✅ テスト結果レポート
├── test-report-template.md          📄 テンプレート
├── export-logs.html                 🔧 ログエクスポートツール
└── README.md                        📚 ガイド
```

---

## 🎯 DoD達成確認

| DoD項目 | 確認方法 | 状態 |
|---------|---------|:----:|
| 実機2OS（iOS/Android）で遷移100%成功 | 11項目全てPass | [ ] |
| 計測パラメータが正しく付与・記録される | testLineUrl()で確認 | [ ] |
| エラー時の代替導線が機能する | エラーアラート表示確認 | [ ] |
| 証跡保存完了 | スクリーンショット10枚＋ログ2件 | [ ] |

---

## 💡 デバッグコマンド

### トラッキングログ表示
```javascript
showTrackingLogs()
```

### トラッキングログクリア
```javascript
clearTrackingLogs()
```

### LINE URL確認
```javascript
testLineUrl('hero')
testLineUrl('qr-modal')
testLineUrl('sticky')
```

### 設定確認
```javascript
console.log(CONFIG)
```

---

## 🚨 トラブルシューティング

### LINEアプリが起動しない
**原因**: LINEアプリ未インストール / LINE URLが間違っている  
**対処**:
1. LINEアプリのインストール確認
2. `main.js` の `CONFIG.lineUrl` を確認
3. ブラウザのポップアップブロック解除

### QRコードが表示されない
**原因**: ネットワーク接続エラー / Google Chart API障害  
**対処**:
1. Wi-Fi接続確認
2. コンソールでエラー確認
3. フォールバック画像表示を確認

### トラッキングログが記録されない
**原因**: ブラウザのプライベートモード / localStorage無効  
**対処**:
1. 通常モードでテスト
2. ブラウザ設定でlocalStorage有効化確認

### 追従CTAが表示されない
**原因**: スクロール量不足（<500px）  
**対処**:
1. 500px以上スクロール
2. コンソールでエラー確認

---

## 📝 テスト完了後のアクション

### 1. レポート作成
```bash
# テンプレートをコピー
cp test-evidence/test-report-template.md test-evidence/test-report.md

# テスト結果を記入
# - デバイス情報
# - テスト結果（Pass/Fail）
# - 不具合詳細
# - DoD達成状況
```

### 2. E1にレビュー依頼
```
件名: [E4] 実機テスト完了報告

本文:
E4（Integrations）の実機テストが完了しました。

【テスト結果】
- iOS: 合格 / 不合格
- Android: 合格 / 不合格
- DoD達成: 全項目達成 / 一部未達成

【証跡】
test-evidence/ ディレクトリに保存済み
- スクリーンショット: 10枚
- ログファイル: 2件
- テスト結果レポート: test-report.md

【次のアクション】
- 本番デプロイ承認申請
- GA4連携確認（E3と協力）

レビューをお願いします。
```

### 3. 不具合があればIssue作成
```
タイトル: [E4] iOS実機テストで○○の不具合

内容:
【現象】
_______________________________

【再現手順】
1. _______________________________
2. _______________________________
3. _______________________________

【期待動作】
_______________________________

【実際の動作】
_______________________________

【環境】
- デバイス: iPhone 14 Pro
- OS: iOS 17.1
- ブラウザ: Safari 17.0

【優先度】
High / Medium / Low

【担当者】
E4 (Integrations)
```

---

## ✅ 最終チェックリスト

```
[ ] 本番LINE URLに設定済み（main.js 11行目）
[ ] UTMパラメータ最終化済み（2025_q4_karaage_order）
[ ] test-evidenceディレクトリ作成済み
[ ] iOS実機テスト完了（11項目）
[ ] Android実機テスト完了（11項目）
[ ] スクリーンショット10枚保存済み
[ ] ログファイル2件保存済み
[ ] test-report.md作成済み
[ ] E1にレビュー依頼済み
[ ] DoD全項目達成確認済み
```

---

## 📞 連絡先

**E4 (Integrations)**: LINE導線・実装担当  
**E1 (Architect)**: プロジェクトリーダー・レビュアー  
**E3 (Data & Tracking)**: GA4計測関連

---

**作成日**: 2025-10-14  
**バージョン**: 1.0（最終版）  
**担当**: E4 (Integrations Engineer)

---

## 🎉 実機テスト完了！

全ての手順が完了したら、お疲れ様でした！

E4（Integrations）タスクは本番デプロイの準備が整いました。

**Happy Testing! 🚀**

