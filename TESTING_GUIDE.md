# 実機テストガイド - iOS/Android LINE遷移確認

## 🎯 DoD（Definition of Done）
- ✅ 実機2OS（iOS/Android）で遷移100%成功
- ✅ 計測パラメータが正しく付与・記録される
- ✅ エラー時の代替導線が機能する

## 📱 テスト対象デバイス

### iOS
- **推奨バージョン**: iOS 15.0以上
- **テスト端末例**: iPhone 12以降
- **ブラウザ**: Safari（標準）

### Android
- **推奨バージョン**: Android 10以上
- **テスト端末例**: Pixel, Galaxy シリーズ
- **ブラウザ**: Chrome（標準）

## 🧪 テストケース一覧

### TC-01: ヒーローCTA（Hero Section）
| 項目 | 内容 |
|------|------|
| **テスト内容** | ヒーローセクションの「LINEで注文する」ボタンをタップ |
| **期待動作** | LINEアプリが起動し、公式アカウント画面に遷移 |
| **確認項目** | ・LINEアプリ起動<br>・遷移成功<br>・計測パラメータ記録 |
| **パラメータ** | `utm_content=hero` |

### TC-02: QRコード表示
| 項目 | 内容 |
|------|------|
| **テスト内容** | 「QRコードを表示」ボタンをタップ |
| **期待動作** | モーダルが表示され、QRコードが生成される |
| **確認項目** | ・モーダル表示<br>・QRコード画像読み込み<br>・スクロール無効化 |
| **パラメータ** | - |

### TC-03: QRモーダル内CTA
| 項目 | 内容 |
|------|------|
| **テスト内容** | QRモーダル内の「LINEで開く」ボタンをタップ |
| **期待動作** | LINEアプリが起動し、公式アカウント画面に遷移 |
| **確認項目** | ・LINEアプリ起動<br>・遷移成功<br>・計測パラメータ記録 |
| **パラメータ** | `utm_content=qr-modal` |

### TC-04: QRコード読み取り
| 項目 | 内容 |
|------|------|
| **テスト内容** | 表示されたQRコードを別のスマホで読み取り |
| **期待動作** | LINEアプリが起動し、公式アカウント画面に遷移 |
| **確認項目** | ・QRコード読み取り成功<br>・LINEアプリ起動<br>・遷移成功 |
| **パラメータ** | `utm_content=qr-modal` |

### TC-05: 追従CTA（Sticky CTA）
| 項目 | 内容 |
|------|------|
| **テスト内容** | 500px以上スクロール後、画面下部に表示される追従CTAをタップ |
| **期待動作** | LINEアプリが起動し、公式アカウント画面に遷移 |
| **確認項目** | ・追従CTA表示<br>・LINEアプリ起動<br>・遷移成功<br>・計測パラメータ記録 |
| **パラメータ** | `utm_content=sticky` |

### TC-06: モーダルを閉じる（×ボタン）
| 項目 | 内容 |
|------|------|
| **テスト内容** | QRモーダルの×ボタンをタップ |
| **期待動作** | モーダルが閉じる、スクロール復活 |
| **確認項目** | ・モーダル非表示<br>・スクロール有効化<br>・計測イベント記録 |
| **パラメータ** | - |

### TC-07: モーダルを閉じる（背景クリック）
| 項目 | 内容 |
|------|------|
| **テスト内容** | QRモーダルの背景（黒い部分）をタップ |
| **期待動作** | モーダルが閉じる |
| **確認項目** | ・モーダル非表示<br>・スクロール有効化 |
| **パラメータ** | - |

### TC-08: エラー処理（LINEアプリ未インストール）
| 項目 | 内容 |
|------|------|
| **テスト内容** | LINEアプリがインストールされていない状態でCTAタップ |
| **期待動作** | 3秒後にエラーアラート表示 |
| **確認項目** | ・アラートメッセージ表示<br>・代替導線案内<br>・エラーイベント記録 |
| **パラメータ** | - |

## 📊 計測パラメータ確認方法

### 方法1: ブラウザ開発者ツール（推奨）

1. **モバイルブラウザで実行**
   - iOS: Safari → 設定 → 詳細 → Web Inspector を有効化
   - Android: Chrome → メニュー → その他のツール → デベロッパーツール

2. **コンソールで確認**
   ```javascript
   // トラッキングログを表示
   showTrackingLogs()
   ```

3. **確認すべき項目**
   - `event`: イベント名（例: `line_cta_click`）
   - `params.location`: CTA配置場所（例: `hero`, `qr-modal`, `sticky`）
   - `params.url`: 遷移先URL（パラメータ含む）
   - `params.device_type`: デバイスタイプ

### 方法2: localStorage確認（実機）

1. **ブラウザのコンソールを開く**

2. **localStorageを確認**
   ```javascript
   localStorage.getItem('azvelia_tracking_logs')
   ```

3. **JSONパース**
   ```javascript
   JSON.parse(localStorage.getItem('azvelia_tracking_logs'))
   ```

### 方法3: テスト用LINE URL確認

```javascript
// ヒーローCTA用URL生成
testLineUrl('hero')

// 期待される出力例:
// https://line.me/R/ti/p/@YOUR_LINE_ID?utm_source=azvelia_lp&utm_medium=web&utm_campaign=order_2025&utm_content=hero&timestamp=1697270400000&ref=hero
```

## ✅ チェックリスト形式テスト手順

### iOS実機テスト
```
[ ] 1. Safariでページを開く
[ ] 2. ヒーローCTAタップ → LINE起動確認
[ ] 3. トラッキングログ確認（showTrackingLogs()）
[ ] 4. QRコード表示ボタンタップ → モーダル表示確認
[ ] 5. QRモーダル内CTAタップ → LINE起動確認
[ ] 6. モーダル閉じる（×ボタン）→ 正常クローズ確認
[ ] 7. 500pxスクロール → 追従CTA表示確認
[ ] 8. 追従CTAタップ → LINE起動確認
[ ] 9. トラッキングログ最終確認
[ ] 10. スクリーンショット保存（証跡）
```

### Android実機テスト
```
[ ] 1. Chromeでページを開く
[ ] 2. ヒーローCTAタップ → LINE起動確認
[ ] 3. トラッキングログ確認（showTrackingLogs()）
[ ] 4. QRコード表示ボタンタップ → モーダル表示確認
[ ] 5. QRモーダル内CTAタップ → LINE起動確認
[ ] 6. モーダル閉じる（背景タップ）→ 正常クローズ確認
[ ] 7. 500pxスクロール → 追従CTA表示確認
[ ] 8. 追従CTAタップ → LINE起動確認
[ ] 9. トラッキングログ最終確認
[ ] 10. スクリーンショット保存（証跡）
```

## 🐛 既知の問題と回避策

### iOS Safari Private Mode
**問題**: Private Modeでは一部localStorageが制限される  
**回避策**: 通常モードでテスト実施

### Android Chrome データセーバー
**問題**: データセーバー有効時、画像読み込みが遅延  
**回避策**: QRコード表示時のエラーハンドリング確認

### LINE アプリ未インストール
**問題**: LINEアプリがない場合、遷移失敗  
**回避策**: 3秒後のエラーアラート表示を確認

## 📸 証跡保存項目

### 各OSで保存すべきスクリーンショット
1. **初期表示**: ヒーローセクション（CTA表示）
2. **QRモーダル**: QRコード生成画面
3. **追従CTA**: スクロール後の追従CTA表示
4. **LINE遷移**: LINE公式アカウント画面（遷移成功）
5. **コンソールログ**: トラッキングログ（`showTrackingLogs()`実行結果）

### トラッキングログCSVエクスポート（オプション）

```javascript
// トラッキングログをCSV形式でダウンロード
function exportTrackingLogsCSV() {
  const logs = JSON.parse(localStorage.getItem('azvelia_tracking_logs') || '[]');
  const csv = [
    ['Timestamp', 'Event', 'Location', 'Device Type', 'URL'],
    ...logs.map(log => [
      log.timestamp,
      log.event,
      log.params?.location || '-',
      log.params?.device_type || '-',
      log.params?.url || '-'
    ])
  ].map(row => row.join(',')).join('\n');
  
  const blob = new Blob([csv], { type: 'text/csv' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `azvelia_tracking_${Date.now()}.csv`;
  a.click();
}

// 実行
exportTrackingLogsCSV();
```

## 🎓 テスト実施者向けガイド

### 事前準備
1. LINEアプリをインストール（両OS）
2. テスト用ブラウザをアップデート（最新版）
3. 開発者ツール使用方法を確認

### テスト実施時の注意点
- **安定したネット環境**: Wi-Fi推奨（モバイル回線でも可）
- **バッテリー残量**: 50%以上推奨
- **通知OFF**: テスト中断を防ぐ

### テスト後の報告項目
1. **テスト日時**: YYYY-MM-DD HH:mm
2. **デバイス情報**: 機種名、OSバージョン、ブラウザバージョン
3. **テスト結果**: 全TCの合否
4. **不具合詳細**: 発生したエラー、再現手順
5. **証跡**: スクリーンショット、ログCSV

## 📋 テスト結果レポートテンプレート

```markdown
# LINE遷移実機テスト結果

**テスト日時**: 2025-10-14 15:30  
**テスター**: [氏名]

## iOS テスト結果

**デバイス**: iPhone 14 Pro  
**OS**: iOS 17.1  
**ブラウザ**: Safari 17.0

| TC | 項目 | 結果 | 備考 |
|----|------|------|------|
| TC-01 | ヒーローCTA | ✅ Pass | 遷移成功 |
| TC-02 | QRコード表示 | ✅ Pass | - |
| TC-03 | QRモーダルCTA | ✅ Pass | 遷移成功 |
| TC-04 | QRコード読取 | ✅ Pass | - |
| TC-05 | 追従CTA | ✅ Pass | 遷移成功 |
| TC-06 | モーダル閉じる（×） | ✅ Pass | - |
| TC-07 | モーダル閉じる（背景） | ✅ Pass | - |
| TC-08 | エラー処理 | ✅ Pass | アラート表示確認 |

**計測パラメータ**: ✅ 全て正常に記録  
**証跡**: スクリーンショット5枚添付

## Android テスト結果

**デバイス**: Pixel 7  
**OS**: Android 14  
**ブラウザ**: Chrome 118.0

| TC | 項目 | 結果 | 備考 |
|----|------|------|------|
| TC-01 | ヒーローCTA | ✅ Pass | 遷移成功 |
| TC-02 | QRコード表示 | ✅ Pass | - |
| TC-03 | QRモーダルCTA | ✅ Pass | 遷移成功 |
| TC-04 | QRコード読取 | ✅ Pass | - |
| TC-05 | 追従CTA | ✅ Pass | 遷移成功 |
| TC-06 | モーダル閉じる（×） | ✅ Pass | - |
| TC-07 | モーダル閉じる（背景） | ✅ Pass | - |
| TC-08 | エラー処理 | ✅ Pass | アラート表示確認 |

**計測パラメータ**: ✅ 全て正常に記録  
**証跡**: スクリーンショット5枚添付

## 総合評価

**遷移成功率**: 100% (16/16 テストケース)  
**計測パラメータ記録**: ✅ 正常  
**エラー時代替導線**: ✅ 機能確認

**DoD達成状況**: ✅ 全項目クリア

## 備考・気づき事項
- [追加コメントがあれば記載]
```

## 🚀 次のステップ

### テスト完了後
1. テスト結果レポート作成
2. E1（Architect）にレビュー依頼
3. 不具合があれば Issue 作成・修正
4. 本番デプロイ承認

### 本番リリース前の最終確認
- [ ] 本番環境でのスモークテスト
- [ ] GA4計測イベント確認
- [ ] Lighthouse スコア確認（Perf≥90）
- [ ] ロールバック手順確認

---

**作成日**: 2025-10-14  
**担当**: E4 (Integrations Engineer)  
**レビュー**: E1 (Lead Architect)

